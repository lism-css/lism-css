---
import '@pagefind/default-ui/css/ui.css';
import { HTML, Flex, Stack } from 'lism-css/astro';
import { Modal } from '@lism-css/ui/astro';
import { getLangFromUrl, t } from '@/lib/i18n';

// é–‹ç™ºç’°å¢ƒã‹ã©ã†ã‹ã‚’åˆ¤å®š
const isDev = import.meta.env.DEV;
const lang = getLangFromUrl(Astro.url);
const searchText = t(lang, 'search');
---

<!-- æ¤œç´¢ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<Modal.Root id="search-modal" isContainer isWrapper p="30" py="40" jc="start">
	<Modal.Inner layout="stack" pos="rel" w="100%" max-h="100%" p="30" g="30" bdrs="20" bxsh="40">
		<Modal.CloseBtn modalId="search-modal" pos="abs" t="0" r="0" z="1" fz="xl" p="10" m="20" />
		<Flex ai="center" jc="between">
			<HTML.span fz="l" fw="bold" class="u-trim">{searchText.title}</HTML.span>
		</Flex>
		<Modal.Body layout="stack" g="30" ov-y="auto">
			{
				isDev ? (
					// <!-- é–‹ç™ºç’°å¢ƒã§ã¯æ¤œç´¢ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒå­˜åœ¨ã—ãªã„ãŸã‚æ³¨æ„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º -->

					<Stack ai="center" g="20">
						<HTML.span fz="3xl" lh="1">
							ğŸ”
						</HTML.span>
						<HTML.span>{searchText.devMessage}</HTML.span>
						<HTML.span tag="code" ff="mono" bgc="base-2" bd bdrs="10" fz="s" px="10">
							$ pnpm build && pnpm preview
						</HTML.span>
						<div class="a--spacer" aria-hidden="true" />
					</Stack>
				) : (
					<div id="search" />
				)
			}
		</Modal.Body>
	</Modal.Inner>
</Modal.Root>
<script>
	window.addEventListener('DOMContentLoaded', async () => {
		const searchContainer = document.getElementById('search');
		if (searchContainer) {
			const { PagefindUI } = await import('@pagefind/default-ui');
			new PagefindUI({
				element: '#search',
				showSubResults: true,
			});
		}
	});
</script>

<style is:global>
	/* ========================================
     Pagefind UI ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰
     ======================================== */

	#search {
		--pagefind-ui-font: inherit;
		--pagefind-ui-text: var(--text);
		--pagefind-ui-background: var(--base);
		--pagefind-ui-primary: var(--brand);
		--pagefind-ui-border: var(--divider);
		--pagefind-ui-border-width: 1px;
		--pagefind-ui-border-radius: var(--bdrs--10);

		/* default: 0.8.  input ã‚µã‚¤ã‚º height: 64px * scale ã¿ãŸã„ã«ã‚µã‚¤ã‚ºè¨ˆç®—ã«ä½¿ã‚ã‚Œã‚‹ã€‚ */
		--pagefind-ui-scale: 0.75;
	}
	/* ol.ui__results */
	#search li.pagefind-ui__result {
		position: relative;
		padding-block: 0;
	}
	#search .pagefind-ui__result-inner {
		margin-top: 0;
	}

	#search .pagefind-ui__result-thumb {
		display: none;
	}
	#search .pagefind-ui__result-title {
		position: relative;
		font-size: 1rem;
		line-height: 1.5;
		align-self: stretch;
	}
	#search .pagefind-ui__result-inner > .pagefind-ui__result-title {
		padding: 0.875em 0.25em;
	}
	#search .pagefind-ui__result-inner > .pagefind-ui__result-excerpt {
		display: none;
		/* position: absolute;
		right: 0;
		top: 0;
		font-size: 0.8em;
		width: 25%;
		white-space: nowrap;
		overflow: hidden;
		text-overflow: ellipsis; */
	}
	#search .pagefind-ui__result-link {
		position: static;
	}
	#search .pagefind-ui__result-link:after {
		content: '';
		position: absolute;
		inset: 0;
		z-index: 1;
		outline-offset: -1px;
		border-radius: var(--bdrs--5);
	}
	#search .pagefind-ui__result-link:hover {
		text-decoration: underline;
		background-color: var(--base-2);
	}
	#search .pagefind-ui__result-link:hover:after {
		outline: 1px solid var(--link);
	}
	#search .pagefind-ui__result-nested {
		position: relative;
		margin-inline-start: 1.5em;
		padding-inline-start: 0.5em;
		padding-block: 0.5em;
		border-top: 1px solid var(--divider);
		align-self: stretch;
	}

	#search .pagefind-ui__result-nested > .pagefind-ui__result-title {
		position: static;
	}
	#search .pagefind-ui__result-excerpt {
		font-size: 0.875rem;
		line-height: 1.5;
	}
</style>
