---
import { Container, Center, HTML, Icon } from 'lism-css/astro';
import { Modal } from '@lism-css/ui/astro';
import { getLangFromUrl, t } from '@/lib/i18n';

const lang = getLangFromUrl(Astro.url);
const tocText = t(lang, 'toc');
---

<Container class="z--fixed">
	<Center d={['grid', null, null, 'none']} pos="fixed" b="0" r="0" z="99">
		<Modal.OpenBtn
			modalId="fixed-toc"
			class="c--fixedTocBtn l--center set-plain -bd -bdrs:10"
			d={null}
			bgc="base"
			c="brand"
			bd
			bdw="2px"
			bdrs="30"
			p="20"
			m="30"
			g="1px"
			bxsh="30"
			ar="1/1"
			hov={{ bgc: 'base-2' }}
			aria-labelledby="toc-open-label"
		>
			<Icon fz="xl" viewBox="0 0 256 256">
				<path
					d="M84,64A12,12,0,0,1,96,52H216a12,12,0,0,1,0,24H96A12,12,0,0,1,84,64Zm132,52H96a12,12,0,0,0,0,24H216a12,12,0,0,0,0-24Zm0,64H96a12,12,0,0,0,0,24H216a12,12,0,0,0,0-24ZM56,52H40a12,12,0,0,0,0,24H56a12,12,0,0,0,0-24Zm0,64H40a12,12,0,0,0,0,24H56a12,12,0,0,0,0-24Zm0,64H40a12,12,0,0,0,0,24H56a12,12,0,0,0,0-24Z"
				></path>
			</Icon>
			<HTML.span fz="2xs" lh="xs">{tocText.title}</HTML.span>
			<HTML.span d="none" id="toc-open-label">{tocText.open}</HTML.span>
		</Modal.OpenBtn>
	</Center>
</Container>

<Modal.Root id="fixed-toc" isContainer isWrapper="s" py="40" px="30">
	<Modal.Inner layout="stack" g="20" w="100%" max-h="100%" pos="relative" py="20" bdrs="20" bxsh="40">
		<Modal.CloseBtn modalId="fixed-toc" autofocus pos="absolute" t="0" r="0" z="1" fz="xl" p="10" m="15" bxsh="10" bdrs="10" bgc="base-2" />
		<Modal.Body layout="stack" g="40" py-s="30" ov-y="auto" z="0">
			<slot />
		</Modal.Body>
	</Modal.Inner>
</Modal.Root>

<script>
	const fixedToc = document.getElementById('fixed-toc');
	if (fixedToc) {
		fixedToc.addEventListener('click', (e) => {
			const target = e.target as HTMLElement;
			if (target.closest('.c--navLink')) {
				const closeBtn = document.querySelector<HTMLElement>('[data-modal-close="fixed-toc"]');
				closeBtn?.click();
			}
		});
	}
</script>
