---
/**
 * 記事詳細ページ（root言語用）
 * - root言語（ja）の記事を表示
 * - URL例: /introduction, /layout/grid-layout
 */
import BaseLayout from '@/layouts/BaseLayout.astro';
import { generateToc } from '@/lib/generateToc';
import { Cluster, Stack, Lism, Flow, HTML } from 'lism-css/astro';
import TagLink from '@ui/TagLink.astro';
import PostNavigation from '@ui/PostNavigation.astro';
import { getPostPathsForRoot } from '@/lib/pageHelpers';
import { getLocalizedUrl, type LangCode } from '@/lib/i18n';
import type { PostEntry } from '@/lib/content';

// MDXでグローバルに使用するコンポーネント
import * as mdxComponents from '@/components/mdx';

// 共通ヘルパーを使用
export const getStaticPaths = getPostPathsForRoot;

interface Props {
	lang: LangCode;
	entry: PostEntry;
}

const { lang, entry } = Astro.props;
const { Content, headings } = await entry.render();

const toc = generateToc(headings);

// アイキャッチ画像: heroがあればそれを、なければOG画像を使用
const eyecatchImage = entry.data.hero || `/og/${entry.slug}.png`;
// OG画像のパス（常に自動生成画像を使用）
const ogImage = `/og/${entry.slug}.png`;

// タグページへのリンク（現在の言語に対応）
const getTagUrl = (tag: string) => getLocalizedUrl(`/tags/${tag}`, lang);

// 日付のフォーマット（言語に応じてロケールを変更）
const dateLocale = lang === 'ja' ? 'ja-JP' : 'en-US';
---

<BaseLayout title={entry.data.title} description={entry.data.description} ogImage={ogImage} toc={toc} lang={lang}>
	<Stack tag="article" class="z--article" g="40" class="set-cqUnit" data-pagefind-body>
		{/* アイキャッチ画像 */}
		{
			// (
			// 	<Frame ar="1200/630" bdrs="20" ov="hidden" bxsh="2">
			// 		<img src={eyecatchImage} alt={entry.data.title} />
			// 	</Frame>
			// )
		}
		{/* 記事メタ情報: タグと日付を横並び */}
		<Cluster tag="aside" class="article-meta" g="20" data-pagefind-ignore>
			<Lism tag="time" fz="s" o="-10" datetime={entry.data.date.toISOString()}>
				{entry.data.date.toLocaleDateString(dateLocale)}
			</Lism>

			{
				entry.data.tags.length > 0 && (
					<Cluster g="10">
						{entry.data.tags.map((tag) => (
							<TagLink href={getTagUrl(tag)}>#{tag}</TagLink>
						))}
					</Cluster>
				)
			}
		</Cluster>

		{/* 記事タイトル */}
		<HTML.h lv="1" class="article-title">{entry.data.title}</HTML.h>

		{/* 記事本文 */}
		<Flow class="article-content" my-s="40">
			<Content components={mdxComponents} />
		</Flow>

		{/* 前後記事ナビゲーション */}
		<PostNavigation currentSlug={entry.slug} lang={lang} />
	</Stack>
</BaseLayout>
